<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"
      integrity="sha512-WJXVjqeINVpi5XXJ2jn0BSCfp0y80IKrYh731gLRnkAS9TKc5KNt/OfLtu+fCueqdWniouJ1ubM+VI/hbo7POQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.js"
      integrity="sha512-TU9AWtV5uUZPX8dbBAH8NQF1tSdigPRRT82vllAQ1Ke28puiqLA6ZVKxtUGlgrH6yWFnkKy+sE6luNEGH9ar0A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <style>
      body {
        background-image: url("spacebglvl3.png");
        background-repeat: no-repeat;
        background-size: 100%;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div class="spaceship"></div>
    <script>
      let astronaut;
      var vh = window.innerHeight;
      console.log(vh);
      var vw = window.innerWidth;
      let cw = vw / 5;
      let ch = vh / 2;
      let sw = cw - 200;
      let sh = ch;
      //making an array to hold the bullets
      let bulletsarray = [];
      //array to hold the aliens
      let aliensarray = [];
      //variable to keep track of our score
      let score = 0;
      function preload() {
        soundFormats('mp3');
        mysound = loadSound('sound.mp3');
        killsound = loadSound('killsound.mp3')
        //use preload for loading up sound
        astronautimg = loadImage("astronaut.png");
        bulletimg = loadImage("bullet.png");
        alien1 = loadImage("alien1.png");
        alien2 = loadImage("alien2.png");
        spaceship = loadImage("spaceship.png");
      }
      function setup() {
        mysound.setVolume(0.1);
        killsound.setVolume(1.0);
        createCanvas(vw, vh);
        //creating a for loop to spawn a certain amount of enemies
        //start i at 0
        //when it is 20 then stop
        //i++ means i is going to go up each time the loop runs
        for (let i = 0; i < 10; i++) {
          let alien = {
            //making the x position so that it is a randm position from 0 to the width
            x: random(10000, vw),
            y: random(10, vh - 50),
          };
          aliensarray.push(alien);
        }
      }
      function draw() {
        //clears so that there isnt a box after box after box
        clear();
        //center the player
        rectMode(CENTER);
        //creating the player
        image(spaceship, sw, sh, 500, 1200);
        image(astronautimg, cw + 50, ch, 130, 130);
        //for everytime there is a bullet in the bullets list (bulletarray) do this
        for (let bullet of bulletsarray) {
          imageMode(CENTER);
          //creating the bullets
          image(bulletimg, bullet.x + 120, bullet.y - 20, 30, 30);
          image(bulletimg, bullet.x + 120, bullet.y, 30, 30);
          image(bulletimg, bullet.x + 120, bullet.y + 20, 30, 30);
          //makes the bullet move across the screen (2 is slow, use higher numbers for faster speeds)
          bullet.x += 15;
          console.log(bullet.y);
        }
        //for everytime there is a alien in the alien list (alliensarray) do this
        for (let alien of aliensarray) {
          //making different aliens
          imageMode(CENTER);
          //makes the alien move across the screen
          alien.x -= 10;
          //creating the bullets
          image(alien1, alien.x, alien.y, 70, 70);
          console.log(alien.y);
          if (alien.x < cw - 100) {
            //this will stop everything
            noLoop();
              window.location.href = "loser.html";
          }
        }
        //checking if for every bullet does it touch an enemy
        //when the bullet hits the alien it goes away
        for (let alien of aliensarray) {
          for (let bullet of bulletsarray) {
            //using dist because I can control how close or how far it has to touch before it kills the alien
            //if the dist between the x and y of the alien and bullet is less than 5 pixels then do what is inside the if statement
            if (dist(alien.x, alien.y, bullet.x, bullet.y) < 80) {
              killsound.play();
              //if it passes ^^ then its going to look into the aliens array and then splice (get rid of) the thing at the location of the index of the enemy
              aliensarray.splice(aliensarray.indexOf(alien), 1);
              bulletsarray.splice(bulletsarray.indexOf(bullet), 1);
              //each time an alien is hit 2 aliens spawn
              let newalien = {
                //making the x position so that it is a randm position from 0 to the width
                x: random(1800, vw),
                y: random(10, vh - 50),
              };
              aliensarray.push(newalien);
              //adding 1 to our score each time
              score += 1;
            }
          }
        }
        if (score >= 130) {
          //this will stop everything
          noLoop();
            window.location.href = "winner.html";
        }
        //drawing the score
        //text(score, 25, 25);
        //fill(0, 102, 153);
        //down key makes character move down
        if (keyIsDown(38)) {
          if (ch >= 50) {
            ch -= 15;
          }
        }
        //up key makes character move up
        if (keyIsDown(40)) {
          if (ch < vh - 60) {
            ch += 15;
          }
        }
      }
      function keyPressed() {
        if (keyCode === 32) {
          mysound.play();
          let bullet = {
            //making the bullets positions when the space button is clicked
            x: cw,
            y: ch,
          };
          bulletsarray.push(bullet);
        }
      }
    </script>
  </body>
</html>
